<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slunk - Encontre Seguidores</title>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Poppins', sans-serif;
        background: radial-gradient(circle at top, #1a002b, #000);
        color: white;
    }
    header {
        padding: 20px;
        text-align: center;
        font-size: 2.3rem;
        font-weight: 700;
        color: #8f3fff;
        text-shadow: 0 0 15px #8f3fff;
        letter-spacing: 2px;
    }

    .top-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .btn-main {
        padding: 12px 25px;
        border-radius: 50px;
        background: #8f3fff;
        border: none;
        cursor: pointer;
        color: white;
        font-size: 1.1rem;
        box-shadow: 0 0 15px #8f3fff;
        transition: 0.2s;
    }
    .btn-main:hover {
        background: #b66bff;
        box-shadow: 0 0 25px #b66bff;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    .card {
        background: rgba(30, 0, 55, 0.7);
        backdrop-filter: blur(10px);
        border: 2px solid #8f3fff;
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 0 20px #8f3fff55;
        transition: 0.25s ease;
    }
    .card:hover {
        transform: scale(1.03);
        box-shadow: 0 0 30px #8f3fff;
    }
    .card img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 3px solid #8f3fff;
        object-fit: cover;
        margin-bottom: 10px;
    }
    .username {
        font-size: 1.4rem;
        font-weight: 600;
    }
    .follow-btn {
        margin-top: 10px;
        padding: 10px 20px;
        border-radius: 50px;
        background: #8f3fff;
        border: none;
        cursor: pointer;
        color: white;
        font-size: 1.1rem;
        box-shadow: 0 0 15px #8f3fff;
    }

    /* MODAL */
    #modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(5px);
        justify-content: center;
        align-items: center;
    }
    #modal-box {
        background: #1a0030;
        border: 2px solid #8f3fff;
        padding: 25px;
        border-radius: 15px;
        width: 350px;
        box-shadow: 0 0 25px #8f3fff;
    }
    input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        border: 2px solid #8f3fff;
        background: rgba(255,255,255,0.05);
        color: white;
    }
</style>

</head>
<body>

<header>SLUNK</header>

<div class="top-buttons">
    <button class="btn-main" id="btnCriar">Criar Perfil</button>
    <button class="btn-main" id="btnUpdate">Atualizar Lista</button>
</div>

<div class="container" id="userContainer"></div>

<footer style="text-align:center;margin:30px;color:#888">
    Slunk Â© 2025 â€” CresÃ§a no Instagram de forma legÃ­tima
</footer>

<!-- MODAL -->
<div id="modal">
    <div id="modal-box">
        <h2 style="text-align:center;color:#b66bff">Criar Perfil</h2>

        <input id="username" placeholder="Nome de usuÃ¡rio">
        <input id="instagram" placeholder="Link do Instagram">
        <input id="fotoInput" type="file" accept="image/*">

        <button class="btn-main" id="btnEnviar">Enviar</button>
        <button class="btn-main" id="btnFechar" style="background:#333">Fechar</button>
    </div>
</div>

<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabase = createClient(
        "https://vcwccnmyzjxwhxoalcuz.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjd2Njbm15emp4d2h4b2FsY3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxNzA2NDgsImV4cCI6MjA3ODc0NjY0OH0.ppmB5Kaaig9Gs8oLxZHSYy5-sDDSsg0DKo3q89Y4Ofk"
    );

    const container = document.getElementById("userContainer");

    async function carregarUsuarios() {
        container.innerHTML = "";

        const { data } = await supabase
            .from("slunk_users")
            .select("*")
            .eq("banned", false);

        data?.forEach(u => criarCard(u));
    }

    function criarCard(u) {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
            <img src="${u.foto}" />
            <div class="username">@${u.username}</div>
            <button class="follow-btn" onclick="window.open('${u.instagram}', '_blank')">Seguir</button>
        `;
        container.appendChild(div);
    }

    // MODAL
    const modal = document.getElementById("modal");
    const btnCriar = document.getElementById("btnCriar");
    const btnFechar = document.getElementById("btnFechar");
    const btnEnviar = document.getElementById("btnEnviar");
    const btnUpdate = document.getElementById("btnUpdate");

    btnCriar.onclick = () => modal.style.display = "flex";
    btnFechar.onclick = () => modal.style.display = "none";
    btnUpdate.onclick = carregarUsuarios;

    // ENVIAR
    btnEnviar.onclick = async () => {
        const username = document.getElementById("username").value;
        const instagram = document.getElementById("instagram").value;
        const fotoFile = document.getElementById("fotoInput").files[0];

        if (!username || !instagram) {
            alert("Preencha nome e Instagram!");
            return;
        }

        // UPLOAD FOTO
        let fotoUrl = "https://via.placeholder.com/150/8f3fff/ffffff?text=SLUNK";

        if (fotoFile) {
            const fileName = `${Date.now()}_${fotoFile.name}`;

            const { data: uploadData, error: uploadError } = await supabase
                .storage
                .from("slunk-fotos")
                .upload(fileName, fotoFile);

            if (!uploadError) {
                fotoUrl = supabase.storage
                    .from("slunk-fotos")
                    .getPublicUrl(fileName).data.publicUrl;
            }
        }

        // SALVAR NO BANCO
        await supabase.from("slunk_users").insert({
            username,
            instagram,
            foto: fotoUrl,
            banned: false
        });

        modal.style.display = "none";
        carregarUsuarios();
    };

    // ðŸ”¥ REALTIME â€” Atualiza automaticamente para TODOS os usuÃ¡rios
    supabase
      .channel("slunk-realtime")
      .on(
        "postgres_changes",
        { event: "*", schema: "public", table: "slunk_users" },
        (payload) => {
            console.log("Realtime:", payload);
            carregarUsuarios();
        }
      )
      .subscribe();

    // Carrega lista inicial
    carregarUsuarios();
</script>

</body>
</html>
